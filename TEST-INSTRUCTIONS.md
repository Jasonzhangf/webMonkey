# Web Automation Orchestrator 插件测试指南

## 问题修复

我们已经修复了以下问题：
1. 修正了manifest.json中弹出窗口的路径
2. 添加了缺失的settings.html文件
3. 更新了测试服务器，使测试页面可以通过HTTP访问

## 安装插件

1. 打开Chrome浏览器
2. 访问 `chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目中的 `plugin/dist` 目录

## 安装并运行测试服务器

### 方法1：使用安装脚本（推荐）

1. 确保已安装Node.js
2. 运行安装脚本：
   ```bash
   chmod +x setup.sh
   ./setup.sh
   ```

### 方法2：手动安装

1. 安装依赖：
   ```bash
   npm install
   ```
2. 启动测试服务器：
   ```bash
   node test-server.js
   ```

## 访问测试页面和控制台

1. 测试控制台：http://localhost:8765
2. 简单测试页面（推荐）：http://localhost:8765/simple-test
3. 完整测试页面：http://localhost:8765/test-page

## 测试步骤

### 1. 基本连接测试

1. 打开Chrome浏览器，确保插件已安装
2. 打开测试页面：http://localhost:8765/test-page
3. 点击浏览器工具栏中的插件图标
4. 在弹出窗口中点击"连接编排器"
5. 检查测试控制台中的消息日志，确认收到连接请求
6. 验证插件状态显示为"已连接"

### 2. 元素选择测试

1. 在测试控制台中选择"节点连接请求"模板
   - 测试控制台位于 http://localhost:8765
   - 在页面右侧的"发送测试消息"面板中，从下拉菜单选择"节点连接请求"
   - 这将加载一个JSON消息模板，其中包含了激活元素选择模式所需的信息
   - 系统会自动尝试获取当前标签页ID并填充到模板中

2. 点击"发送消息"按钮
   - 这会将节点连接请求发送到插件
   - 插件收到请求后会进入元素选择模式

3. 在测试页面上选择元素
   - 简单测试页面位于 http://localhost:8765/simple-test（推荐）
   - 或者完整测试页面位于 http://localhost:8765/test-page
   - 当鼠标悬停在元素上时，元素会被高亮显示
   - 元素旁边会出现一个"选择此元素"按钮
   - 点击该按钮，插件会捕获该元素的信息

4. 检查测试控制台中的消息日志，确认收到元素选择消息
   - 在测试控制台左侧的"消息日志"面板中，应该能看到一条新的"收到"消息
   - 消息类型应为"element_selected"
   - 消息内容包含所选元素的详细信息，如CSS选择器、XPath等

### 3. 操作定义测试

1. 在测试控制台中选择"节点连接请求"模板
   - 测试控制台位于 http://localhost:8765
   - 在页面右侧的"发送测试消息"面板中，从下拉菜单选择"节点连接请求"

2. 修改`connection_mode`为"operation_definition"
   - 在JSON编辑器中找到`"connection_mode": "element_selection"`
   - 将其修改为`"connection_mode": "operation_definition"`
   - 这将使插件进入操作定义模式，而不仅仅是元素选择模式

3. 点击"发送消息"按钮
   - 这会将修改后的节点连接请求发送到插件
   - 插件收到请求后会进入操作定义模式

4. 在测试页面上选择元素并定义操作
   - 简单测试页面位于 http://localhost:8765/simple-test（推荐）
   - 或者完整测试页面位于 http://localhost:8765/test-page
   - 当鼠标悬停在元素上时，元素会被高亮显示
   - 点击元素旁边的"选择此元素"按钮，会弹出操作菜单
   - 在操作菜单中选择操作类型（如点击、输入等）
   - 根据操作类型，可能需要设置额外的参数

5. 检查测试控制台中的消息日志，确认收到操作定义消息
   - 在测试控制台左侧的"消息日志"面板中，应该能看到一条新的"收到"消息
   - 消息类型应为"operation_defined"
   - 消息内容包含所定义操作的详细信息，如操作类型、参数等

### 4. 断线重连测试

1. 关闭测试服务器（按Ctrl+C）
2. 观察插件状态变为"未连接"
3. 重新启动测试服务器
4. 验证插件能够自动重新连接

## 故障排除

如果仍然遇到"无法访问您的文件"错误：

1. 检查Chrome扩展页面中的错误信息
2. 尝试重新加载插件
3. 检查浏览器控制台是否有错误信息
4. 确保所有文件路径正确

如果遇到其他问题，请查看浏览器控制台和测试服务器控制台的错误信息。